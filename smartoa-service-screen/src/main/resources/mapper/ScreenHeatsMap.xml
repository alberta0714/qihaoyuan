<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.smartoa.service.mapper.ScreenHeatsMapper">
<!-- 每天印量 -->
<select id="scPrintDaily" resultType="map">
	SELECT 
	  id, data_date, tb_device_id, device_serial_num, black_count_daily, color_count_daily
	FROM
	  `ts_device_read_print_daily_${year1}`
	WHERE 1=1 
	 AND data_date&gt;=#{startTime}
	 AND data_date&lt;=#{endTime}
	<if test="year2!=null and year2!=''">
	UNION  ALL 
	  SELECT 
	  id, data_date, tb_device_id, device_serial_num, black_count_daily, color_count_daily
	FROM
	  `ts_device_read_print_daily_${year2}`
	WHERE 1=1 
	 AND data_date&gt;=#{startTime}
	 AND data_date&lt;=#{endTime}
	 </if>
</select>
<!-- 印量包 -->
<select id="scPackagePrintingList" resultType="map">
SELECT id, tb_device_id, price FROM `tb_package_printing`
</select>
<!-- 结算 -->
<select id="scDevicePrintSettlementList" resultType="map">
  SELECT 
  id,
  data_date,
  device_serial_num,
  push_time,
  black_print_use,
  color_print_use ,
  black_money,
  color_money
FROM
  `tb_device_print_settlement`
WHERE 1=1
 <if test="startTime!=null and startTime!=''">
AND data_date&gt;='${startTime}'
 </if>
 <if test="endTime!=null and endTime!=''">
AND data_date&lt;='${endTime}'
 </if>
</select>
<!-- 存储阿里 atlas数据 -->
<insert id="insertAtlas">
	INSERT INTO `smartoa`.`tb_geo_atlas`
	 (`name`, `level`, `parent`, `people_count_2010`, `adcode`, `lng`, `lat`) 
	VALUES
	('${name}', '${level}', '${parent}', '${peopleCount2010}', '${adcode}', '${lng}', '${lat}'); 
</insert>
<!-- 查询 atlas -->
<select id="scGeoAtlasList" resultType="com.smartoa.service.model.GeoAtlas">
	SELECT * FROM tb_geo_atlas
</select>
<!-- 工程师进程查询 -->
<select id="scEngineerProcessList" resultType="com.smartoa.service.model.EngineerProcess">
	 SELECT 
	 	id, work_order_id,leave_for_time 
	 FROM 
	 	tb_engineer_process
	 WHERE 1=1
	 <if test="startTime!=null and startTime!=''">
	 	AND leave_for_time&gt;='${startTime}'
	 </if>
	 <if test="endTime!=null and endTime!=''">
	 	AND leave_for_time&lt;='${endTime}'
	 </if>
</select>
<!-- 工单处理 -->
<select id="scWorkOrderOprList" resultType="com.smartoa.service.model.WorkOrderOpr">
	SELECT 
	  id,
	  work_order_id,
	  engineer_id,
	  leave_time 
	FROM
	  tb_work_order_opr 
	WHERE 1=1
	 <if test="timeStart!=null and timeStart!=''">
	  AND leave_time&gt;='${timeStart}'
	  </if>
	 <if test="timeEnd!=null and  timeEnd!=''">
	  AND leave_time&lt;='${timeEnd}'
	  </if>
</select>

<select id="scUserBill" resultType="com.smartoa.service.model.screen.other.ScreenUserBill">
	-- 账单编号 用户名  所属服务商  账单日  租金，抄表，印量包 
SELECT 
  ubill.`username` user_name,
  u.`org_id` as cust_id,
  (SELECT `tr_device_lease`.`servicer_id` FROM `tr_device_lease` WHERE tr_device_lease.`status`=1 AND `tr_device_lease`.`cust_id`=u.`org_id` LIMIT 1) AS servicer_id,
  cust.`delivery_address_province`,
  province.`provinces` province,
  cust.`delivery_address_city`,
  city.`city` city,
  cust.`delivery_address_county`,
  ac.`area_county` country,
  ubill.`bill_date`,
  ubill.`device_amount`,
  ubill.`paper_amount`,
  ubill.`print_amount` 
FROM
  `tb_sync_bill` ubill 
  LEFT JOIN tb_user u 
    ON u.`user_name` = ubill.`username` 
  left join tb_cust cust 
    on cust.`id` = u.`org_id` 
  left join `td_sys_provinces` province 
    on province.`provinces_code` = cust.`delivery_address_province` 
  left join `td_sys_city` city 
    on city.`city_code` = cust.`delivery_address_city` 
  left join `td_sys_area_county` ac 
    on ac.`area_code` = cust.`delivery_address_county` 
where 1 = 1 
	<if test="start!=null">
		and ubill.bill_date&gt;=#{start}
	</if>
	<if test="end!=null">
		and ubill.bill_date&lt;=#{end}
	</if>
	order by ubill.bill_date asc
</select>




</mapper>
